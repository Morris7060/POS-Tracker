<!doctype html>
<html lang="en" x-data="app()" x-init="initApp()">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ICT Admin ‚Äî Enterprise POS Dashboard</title>
  <link rel="icon" href="logo.png" type="image/png" />

  <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <link rel="stylesheet" href="./dist/output.css" />
  


  <style>
    [x-cloak]{display:none!important} 
    .cursor-sort{cursor:pointer}
    /* Modal slide-in animation */
    .slide-in {
      transform: translateX(100%);
      transition: transform 0.3s ease-in-out;
    }
    .slide-in.show {
      transform: translateX(0);
    }
    /* Modal fade-scale animation */
    .fade-scale {
      transform: scale(0.95);
      opacity: 0;
      transition: all 0.2s ease-in-out;
    }
    .fade-scale.show {
      transform: scale(1);
      opacity: 1;
    }
    /* Tailwind base styles (NOTE: Remove these from the <style> block and use a build process for production) */
    @tailwind base;
    @tailwind components;
    @tailwind utilities;
  </style>
</head>
<body class="bg-white text-slate-900">

<script>
/* -----------------------
  CONFIG: your Supabase (Must be defined before main.js runs)
----------------------- */
const SUPABASE_URL = 'https://drvkqsjlartfeatujwzu.supabase.co';
// Replace 'YOUR_SUPABASE_ANON_KEY' with your real key locally
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRydmtxc2psYXJ0ZmVhdHVqd3p1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwODI0NjIsImV4cCI6MjA3NTY1ODQ2Mn0.GZpN-ciQaP25izB1f8OZaLOOstCuaKrfDSWnE7x_79c';

window.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
</script>

<div class="min-h-screen flex">

  <aside class="w-72 bg-sky-800 text-white flex flex-col">
    <div class="p-4 border-b border-sky-700 flex items-center gap-3">
      <img src="image/logo (2).png" alt="Logo" class="w-10 h-10 object-contain rounded-sm shadow-sm" onerror="this.style.display='none'"/>
      <div>
        <div class="font-bold text-lg">ICT Admin</div>
        <div class="text-xs opacity-80">POS Tracking </div>
      </div>
    </div>

    <nav class="p-4 flex-1 space-y-1">
      <button @click.prevent="nav('dashboard')" :class="view==='dashboard'?'bg-sky-700':''" class="w-full text-left px-3 py-2 rounded flex items-center gap-3">
        <i data-lucide="layout-dashboard" class="w-5 h-5"></i><span>Dashboard</span>
      </button>

      <button @click.prevent="nav('supervisors')" 
              :class="view==='supervisors'?'bg-sky-700':''"
              class="w-full text-left px-3 py-2 rounded flex items-center gap-3">
        <i data-lucide="users" class="w-5 h-5"></i><span>Supervisors</span>
      </button>

      <button @click.prevent="nav('agents')" :class="view==='agents'?'bg-sky-700':''" class="w-full text-left px-3 py-2 rounded flex items-center gap-3">
        <i data-lucide="user" class="w-5 h-5"></i><span>Agents</span>
      </button>

      <button @click.prevent="nav('pos')" :class="view==='pos'?'bg-sky-700':''" class="w-full text-left px-3 py-2 rounded flex items-center gap-3">
        <i data-lucide="tablet-smartphone" class="w-5 h-5"></i><span>POS Devices</span>
      </button>

      <button @click.prevent="nav('logs')" :class="view==='logs'?'bg-sky-700':''" class="w-full text-left px-3 py-2 rounded flex items-center gap-3">
        <i data-lucide="activity" class="w-5 h-5"></i><span>Activity Logs</span>
      </button>
<button @click.prevent="nav('report'); fetchAgentsPerSupervisor()" 
        :class="view==='report'?'bg-sky-700':''" 
        class="w-full text-left px-3 py-2 rounded flex items-center gap-3">
    <i data-lucide="file-text" class="w-5 h-5"></i><span>Report</span>
</button>


      <button @click.prevent="nav('settings')" :class="view==='settings'?'bg-sky-700':''" class="w-full text-left px-3 py-2 rounded flex items-center gap-3">
        <i data-lucide="settings" class="w-5 h-5"></i><span>Settings</span>
      </button>
    </nav>

    <div class="p-4 border-t border-sky-700 text-xs">
      <div class="opacity-80">Signed in as</div>
      <div class="font-semibold"> ICT Officer</div>
    </div>
  </aside>

  <main class="flex-1 p-6 overflow-auto">
    <header class="flex items-center justify-between mb-6">
      <div>
        <h1 id="pageTitle" class="text-2xl font-bold">Dashboard</h1>
        <p id="pageSub" class="text-sm opacity-70">Enterprise POS ‚Äî sorting, pagination, RLS-ready</p>
      </div>

      <div class="flex items-center gap-3">
        <input x-model="globalSearch" @input="applySearch()" placeholder="Search supervisors, agents, POS..." class="p-2 border rounded w-80" aria-label="Global search" />
        <button @click="refreshAll()" class="bg-white px-3 py-2 rounded border">üîÑ Refresh</button>
      </div>
    </header>
      <section x-show="view==='report'" x-cloak> <h2 class="text-2xl font-bold mb-4">Agents per Supervisor</h2>

  <div class="mb-4">
    <label for="supervisorSelect" class="font-semibold block mb-1">Select Supervisor:</label>
    <select id="supervisorSelect" x-model="selectedSupervisorId"
            class="w-full p-2 border rounded">
      <option value="">-- Choose Supervisor --</option>
      <template x-for="group in agentsPerSupervisor" :key="group.supervisor_id">
        <option :value="group.supervisor_id" x-text="group.supervisor"></option>
      </template>
    </select>
  </div>

  <div class="bg-white rounded shadow p-4 overflow-auto max-h-[60vh]">
    <template x-if="selectedSupervisorAgents.length > 0">
      <table class="table-auto w-full border-collapse">
        <thead>
          <tr class="bg-gray-200">
            <th class="border px-4 py-2">Agent Name</th>
            <th class="border px-4 py-2">Contact</th>
            <th class="border px-4 py-2">Actions</th>
          </tr>
        </thead>
        <tbody>
          <template x-for="(agent, index) in selectedSupervisorAgents" :key="agent.agent_id">
            <tr :class="index % 2 === 0 ? 'bg-white' : 'bg-gray-50'">
              <td class="border px-4 py-2" x-text="agent.name"></td>
              <td class="border px-4 py-2" x-text="agent.contact || 'No contact'"></td>
              <td class="border px-4 py-2 space-x-2">
                <button class="bg-blue-500 text-white px-2 py-1 rounded"
                        @click="openModal('editAgent', agent)">Edit</button>
                <button class="bg-red-500 text-white px-2 py-1 rounded"
                        @click="deleteAgent(agent)">Delete</button>
              </td>
            </tr>
          </template>
        </tbody>
      </table>
    </template>
    <template x-if="selectedSupervisorAgents.length === 0">
      <p class="text-gray-500">No agents available for this supervisor.</p>
    </template>
  </div>

<div class="flex space-x-4">
    <button 
        class="bg-white text-sky-700 px-3 py-2 rounded border flex items-center space-x-2" 
        @click="exportAgentsPerSupervisorPDF()"
    >
        <i data-lucide="file-text" class="w-4 h-4"></i>
        <span>Export PDF Report</span>
    </button>
    
    <button 
        class="bg-white text-sky-700 px-3 py-2 rounded border flex items-center space-x-2" 
        @click="exportAgentsPerSupervisorCSV()"
    >
        <i data-lucide="download" class="w-4 h-4"></i>
        <span>Export CSV Report</span>
    </button>
</div>
</section>
</section>

<div class="p-4 bg-white rounded-2xl shadow-md mb-6 flex flex-col items-start">
  <h2 id="greeting" class="text-2xl font-bold text-gray-800"></h2>
  <p id="time" class="text-lg text-gray-500"></p>
</div>

</section>

<div class="p-4 sm:p-6 lg:p-8">

    <div class="p-4 bg-white rounded-2xl shadow-md mb-6 flex flex-col items-start">
        <h2 id="greeting" class="text-xl sm:text-2xl font-bold text-gray-800"></h2>
        <p id="time" class="text-sm sm:text-lg text-gray-500"></p>
    </div>

    <section x-show="view==='dashboard'" x-cloak>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-white p-4 rounded shadow">
                <h3 class="text-lg font-semibold">Supervisors</h3>
                <p class="text-2xl font-bold text-slate-700" x-text="counts.supervisors"></p>
            </div>

            <div class="bg-white p-4 rounded shadow">
                <h3 class="text-lg font-semibold">Agents</h3>
                <p class="text-2xl font-bold text-slate-700" x-text="counts.agents"></p>
            </div>

            <div class="bg-white p-4 rounded shadow">
                <h3 class="text-lg font-semibold">POS Devices</h3>
                <p class="text-2xl font-bold text-slate-700" x-text="counts.pos"></p>
            </div>
        </div>

        <div class="bg-white p-4 rounded shadow mt-6 mx-auto w-full lg:max-w-5xl">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-lg font-semibold">Agents per Supervisor</h3>
                <button
                    class="bg-slate-100 hover:bg-slate-200 px-3 py-1 rounded text-sm flex items-center gap-1"
                    @click="toggleChartType()"
                    aria-pressed="false"
                >
                    <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                    <span x-text="chartType === 'bar' ? 'Switch to Pie' : 'Switch to Bar'"></span>
                </button>
            </div>
            
            <div class="h-96 relative">
                <canvas id="agentsChart" aria-label="Agents per supervisor chart"></canvas>
            </div>
        </div>
    </section>

    <section x-show="view==='agents'" x-cloak>
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold">Agents</h2>
        <div class="flex gap-2">
          <button class="bg-green-600 text-white px-3 py-2 rounded" @click="openModal('addAgent')">‚ûï Add</button>
          <button class="bg-white px-3 py-2 rounded border" @click="exportPDF('agents')"><i data-lucide="file-down" class="w-4 h-4 inline"></i> PDF</button>
          <button class="bg-white px-3 py-2 rounded border" @click="exportCSVServer('agents')"><i data-lucide="download" class="w-4 h-4 inline"></i> CSV</button>
        </div>
      </div>

      <div class="mb-2 flex items-center gap-2">
        <input id="filterAgents" name="filterAgents" placeholder="Filter or search..." x-model="filterText" @input="fetchAgents()" class="p-2 border rounded w-1/3" />
        <div class="ml-auto text-sm opacity-70">Showing <span x-text="agentsCountDisplay"></span></div>
      </div>

      <div class="bg-white rounded shadow overflow-auto">
        <table class="min-w-full text-sm" role="table" aria-label="Agents table">
          <thead class="bg-slate-100">
            <tr>
              <th class="p-2 text-left cursor-sort" @click="changeSort('name', 'agents')">Name <i data-lucide="chevrons-up-down" class="w-4 h-4 inline"></i></th>
              <th class="p-2 text-left cursor-sort" @click="changeSort('contact','agents')">Contact <i data-lucide="chevrons-up-down" class="w-4 h-4 inline"></i></th>
              <th class="p-2 text-left">Supervisor</th>
              <th class="p-2 text-left">Actions</th>
            </tr>
          </thead>
          <tbody>
            <template x-for="a in agents" :key="a.agent_id">
              <tr class="border-b hover:bg-slate-50">
                <td class="p-2" x-text="a.name"></td>
                <td class="p-2" x-text="a.contact"></td>
                <td class="p-2" x-text="a.supervisor_name || '‚Äî'"></td>
                <td class="p-2">
                  <button @click="openModal('editAgent', a)" class="p-2 rounded hover:bg-slate-100" title="Edit agent"><i data-lucide="edit" class="w-4 h-4"></i></button>
                  <button @click="confirmDeleteAgent(a.agent_id)" class="p-2 rounded hover:bg-slate-100 text-red-500" title="Delete agent"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                </td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>

      <div class="flex items-center justify-between mt-3">
        <div>
          <button class="px-3 py-1 border rounded mr-2" :disabled="agtPage===1" @click="changePage('prev','agents')">‚¨Ö Prev</button>
          <button class="px-3 py-1 border rounded" :disabled="(agtPage * agtPageSize) >= agentsTotal" @click="changePage('next','agents')">Next ‚û°</button>
        </div>
        <div class="text-sm opacity-80">Page <span x-text="agtPage"></span> ‚Ä¢ Page size
          <select x-model.number="agtPageSize" @change="fetchAgents()" class="ml-2 border rounded p-1" aria-label="Agents page size">
            <option :value="10">10</option><option :value="25">25</option><option :value="50">50</option>
          </select>
        </div>
      </div>
    </section>
<section x-show="view==='supervisors'" x-cloak>
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-2xl font-bold">Supervisors</h2>
    <div class="flex gap-2">
      <button class="bg-green-600 text-white px-3 py-2 rounded" @click="openModal('addSupervisor')">‚ûï Add Supervisor</button>
      <button class="bg-white px-3 py-2 rounded border" @click="exportPDF('supervisors')">PDF</button>
      <button class="bg-white px-3 py-2 rounded border" @click="exportCSVServer('supervisors')">CSV</button>
    </div>
  </div>

  <div class="mb-2 flex items-center gap-2">
    <input id="filterSupervisors" name="filterSupervisors" placeholder="Filter or search..." x-model="filterText" @input="fetchSupervisors()" class="p-2 border rounded w-1/3" />
    <div class="ml-auto text-sm opacity-70">Showing <span x-text="supervisorsCountDisplay"></span></div>
  </div>

  <div class="bg-white rounded shadow overflow-auto">
    <table class="min-w-full text-sm" role="table" aria-label="Supervisors table">
      <thead class="bg-slate-100">
        <tr>
          <th class="p-2 text-left cursor-sort" @click="changeSort('name','supervisors')">Name <i data-lucide="chevrons-up-down" class="w-4 h-4 inline"></i></th>
          <th class="p-2 text-left cursor-sort" @click="changeSort('region','supervisors')">Region <i data-lucide="chevrons-up-down" class="w-4 h-4 inline"></i></th>
          <th class="p-2 text-left">Agents</th>
          <th class="p-2 text-left">POS Assigned</th>
          <th class="p-2 text-left">Actions</th>
        </tr>
      </thead>
      <tbody>
        <template x-for="s in supervisors" :key="s.supervisor_id">
          <tr class="border-b hover:bg-slate-50">
            <td class="p-2" x-text="s.name"></td>
            <td class="p-2" x-text="s.region"></td>
            <td class="p-2" x-text="s.agent_count || 0"></td>
            <td class="p-2" x-text="s.pos_assigned || 0"></td>
            <td class="p-2">
              <button @click="openModal('editSupervisor', s)" class="p-2 rounded hover:bg-slate-100" title="Edit"><i data-lucide="edit" class="w-4 h-4"></i></button>
              <button @click="confirmDeleteSupervisor(s.supervisor_id)" class="p-2 rounded hover:bg-slate-100 text-red-500" title="Delete"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
            </td>
          </tr>
        </template>
      </tbody>
    </table>
  </div>

  <div class="flex items-center justify-between mt-3">
    <div>
      <button class="px-3 py-1 border rounded mr-2" :disabled="supPage===1" @click="changePage('prev','supervisors')">‚¨Ö Prev</button>
      <button class="px-3 py-1 border rounded" :disabled="(supPage*supPageSize) >= supervisorsTotal" @click="changePage('next','supervisors')">Next ‚û°</button>
    </div>
    <div class="text-sm opacity-80">Page <span x-text="supPage"></span> ‚Ä¢ Page size
      <select x-model.number="supPageSize" @change="fetchSupervisors()" class="ml-2 border rounded p-1">
        <option :value="10">10</option>
        <option :value="25">25</option>
        <option :value="50">50</option>
      </select>
    </div>
  </div>
</section>

    <section x-show="view==='pos'" x-cloak>
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold">POS Devices</h2>
        <button class="bg-green-600 text-white px-3 py-2 rounded" @click="openModal('addPOS')">‚ûï Add POS</button>
      </div>

      <div class="bg-white rounded shadow overflow-auto">
        <table class="min-w-full text-sm" role="table" aria-label="POS devices table">
          <thead class="bg-slate-100">
            <tr><th class="p-2">Serial</th><th class="p-2">Agent</th><th class="p-2">Status</th><th class="p-2">Condition</th><th class="p-2">Actions</th></tr>
          </thead>
          <tbody>
            <template x-for="p in pos_devices" :key="p.pos_id">
              <tr class="border-b hover:bg-slate-50">
                <td class="p-2" x-text="p.serial_number"></td>
                <td class="p-2" x-text="p.agent_name || '‚Äî'"></td>
                <td class="p-2" x-text="p.status"></td>
                <td class="p-2" x-text="p.condition"></td>
                <td class="p-2">
                  <button @click="openModal('editPOS', p)" class="p-2 rounded hover:bg-slate-100" title="Edit POS"><i data-lucide="edit" class="w-4 h-4"></i></button>
                  <button @click="confirmDeletePOS(p.pos_id)" class="p-2 rounded hover:bg-slate-100 text-red-500" title="Delete POS"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                </td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>
    </section>

    <section x-show="view==='logs'" x-cloak>
      <h2 class="text-2xl font-bold mb-4">Activity Logs</h2>
      <div class="mb-3 flex gap-2">
        <input id="logsFilter" name="logsFilter" x-model="logsFilter" @input="applyLogsFilter()" placeholder="Filter logs..." class="p-2 border rounded w-1/3" />
        <button class="bg-white px-3 py-2 rounded border" @click="exportLogsCSV()">üì§ Export Logs CSV</button>
        <button class="bg-white px-3 py-2 rounded border" @click="exportPDF('activity_logs')">üßæ Export Logs PDF</button>
      </div>
      <div class="bg-white rounded shadow p-4 h-96 overflow-auto">
        <template x-for="l in filteredActivityLogs" :key="l.id">
          <div class="mb-3">
            <div class="text-sm font-medium" x-text="(l.user_name || 'ICT') + ' ‚Ä¢ ' + (new Date(l.created_at)).toLocaleString()"></div>
            <div class="text-xs opacity-70" x-text="l.action + (l.details ? (' ‚Äî ' + l.details) : '')"></div>
          </div>
        </template>
      </div>
    </section>

    <section x-show="view==='settings'" x-cloak>
      <h2 class="text-2xl font-bold mb-4">Settings</h2>
      <div class="bg-white rounded shadow p-4 max-w-xl">
        <div class="mb-3">
          <label for="adminName" class="block text-sm mb-1">Admin Name</label>
          <input id="adminName" name="adminName" x-model="settings.admin_name" class="w-full p-2 border rounded" autocomplete="name" />
        </div>
        <div class="mb-3">
          <label for="adminEmail" class="block text-sm mb-1">Email</label>
          <input id="adminEmail" name="adminEmail" x-model="settings.email" class="w-full p-2 border rounded" autocomplete="email" />
        </div>
        <div class="flex gap-2">
          <button @click="saveSettings()" class="bg-sky-700 text-white px-3 py-2 rounded">Save Settings</button>
          <button @click="exportBackupJSON()" class="bg-white px-3 py-2 rounded border">üì• Download Backup</button>
        </div>
      </div>
    </section>
  </main>
</div>

<div x-show="modalOpen" x-cloak class="fixed inset-0 z-50 flex">
  <div @click="closeModal()" class="absolute inset-0 bg-black/40"></div>
  <div class="ml-auto w-full max-w-xl bg-white h-full shadow-lg p-6 overflow-auto slide-in" :class="modalOpen? 'show':''" role="dialog" aria-modal="true">
    <div class="flex items-start justify-between">
      <div>
        <h3 class="text-xl font-semibold" x-text="modalTitle"></h3>
        <p class="text-sm opacity-70" x-text="modalSubtitle"></p>
      </div>
      <div class="flex gap-2">
        <button class="px-3 py-1 rounded border" @click="prevModalStep()" x-show="modalStep>1">‚Üê Back</button>
        <button class="px-3 py-1 rounded border" @click="closeModal()">Close</button>
      </div>
    </div>

    <div class="mt-4">
      <div x-show="modalType==='addSupervisor' || modalType==='editSupervisor'">
        <div x-show="modalStep===1" class="fade-scale" :class="modalStep===1? 'show':''">
          <label class="block mb-2" for="supName">Name
            <input id="supName" name="supName" class="w-full p-2 border rounded" x-model="form.name" autocomplete="name" />
          </label>
          <label class="block mb-2" for="supRegion">Region
            <input id="supRegion" name="supRegion" class="w-full p-2 border rounded" x-model="form.region" />
          </label>
          <div class="flex justify-end"><button class="bg-sky-700 text-white px-4 py-2 rounded" @click="nextModalStep()">Next</button></div>
        </div>
        <div x-show="modalStep===2" class="fade-scale" :class="modalStep===2? 'show':''">
          <h4 class="font-semibold">Confirm</h4>
          <div class="mb-3">
            <div><strong>Name:</strong> <span x-text="form.name"></span></div>
            <div><strong>Region:</strong> <span x-text="form.region"></span></div>
          </div>
          <div class="flex justify-end gap-2">
            <button class="px-3 py-2 rounded border" @click="prevModalStep()">Back</button>
            <button class="bg-green-600 text-white px-3 py-2 rounded" @click="modalType==='addSupervisor'? addSupervisorConfirm() : updateSupervisorConfirm()">Confirm</button>
          </div>
        </div>
      </div>

      <div x-show="modalType==='addAgent' || modalType==='editAgent'">
        <div x-show="modalStep===1" class="fade-scale" :class="modalStep===1? 'show':''">
          <label class="block mb-2" for="agtName">Name
            <input id="agtName" name="agtName" class="w-full p-2 border rounded" x-model="form.name" autocomplete="name" />
          </label>
          <label class="block mb-2" for="agtContact">Contact
            <input id="agtContact" name="agtContact" class="w-full p-2 border rounded" x-model="form.contact" autocomplete="tel" />
          </label>
          <label class="block mb-2" for="agtLocation">Location
            <input id="agtLocation" name="agtLocation" class="w-full p-2 border rounded" x-model="form.location" />
          </label>
          <label class="block mb-2" for="agtSupervisor">Supervisor
            <select id="agtSupervisor" name="agtSupervisor" class="w-full p-2 border rounded" x-model="form.supervisor_id">
              <option value="">Select</option>
              <template x-for="s in supSelect" :key="s.supervisor_id"><option :value="s.supervisor_id" x-text="s.name"></option></template>
            </select>
          </label>
          <div class="flex justify-end"><button class="bg-sky-700 text-white px-4 py-2 rounded" @click="nextModalStep()">Next</button></div>
        </div>
        <div x-show="modalStep===2" class="fade-scale" :class="modalStep===2? 'show':''">
          <h4 class="font-semibold">Confirm Agent</h4>
          <div class="mb-3">
            <div><strong>Name:</strong> <span x-text="form.name"></span></div>
            <div><strong>Supervisor:</strong> <span x-text="(supSelect.find(s=>s.supervisor_id===form.supervisor_id)||{name:''}).name"></span></div>
          </div>
          <div class="flex justify-end gap-2">
            <button class="px-3 py-2 rounded border" @click="prevModalStep()">Back</button>
            <button class="bg-green-600 text-white px-3 py-2 rounded" @click="modalType==='addAgent'? addAgentConfirm() : updateAgentConfirm()">Confirm</button>
          </div>
        </div>
      </div>

      <div x-show="modalType==='addPOS' || modalType==='editPOS'">
        <div x-show="modalStep===1" class="fade-scale" :class="modalStep===1? 'show':''">
          <label class="block mb-2" for="posSerial">Serial Number
            <input id="posSerial" name="posSerial" class="w-full p-2 border rounded" x-model="form.serial_number" />
          </label>
          <label class="block mb-2" for="posAgent">Assign to Agent
            <select id="posAgent" name="posAgent" class="w-full p-2 border rounded" x-model="form.agent_id">
              <option value="">Unassigned</option>
              <template x-for="a in all_agents" :key="a.agent_id"><option :value="a.agent_id" x-text="a.name"></option></template>
            </select>
          </label>
          <label class="block mb-2" for="posStatus">Status
            <select id="posStatus" name="posStatus" class="w-full p-2 border rounded" x-model="form.status"><option>Available</option><option>Active</option><option>Returned</option><option>Inactive</option></select>
          </label>
          <label class="block mb-2" for="posCondition">Condition
            <select id="posCondition" name="posCondition" class="w-full p-2 border rounded" x-model="form.condition"><option>Excellent</option><option>Good</option><option>Needs Repair</option><option>Damaged</option></select>
          </label>
          <div class="flex justify-end"><button class="bg-sky-700 text-white px-4 py-2 rounded" @click="nextModalStep()">Next</button></div>
        </div>
        <div x-show="modalStep===2" class="fade-scale" :class="modalStep===2? 'show':''">
          <h4 class="font-semibold">Confirm POS</h4>
          <div class="mb-3">
            <div><strong>Serial:</strong> <span x-text="form.serial_number"></span></div>
            <div><strong>Agent:</strong> <span x-text="(all_agents.find(x=>x.agent_id===form.agent_id)||{name:'Unassigned'}).name"></span></div>
          </div>
          <div class="flex justify-end gap-2">
            <button class="px-3 py-2 rounded border" @click="prevModalStep()">Back</button>
            <button class="bg-green-600 text-white px-3 py-2 rounded" @click="modalType==='addPOS'? addPOSConfirm() : updatePOSConfirm()">Confirm</button>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<div x-data="{ toasts: [] }" x-init="$watch('toasts', () => { toasts.forEach(t => setTimeout(()=> toasts.splice(toasts.indexOf(t),1), 4200)) })" class="fixed top-4 right-4 z-50 pointer-events-none">
  <template x-for="(t,i) in toasts" :key="i">
    <div class="bg-white border rounded shadow px-4 py-2 mb-2 pointer-events-auto flex items-center gap-3">
      <div class="text-2xl" x-text="t.emoji"></div>
      <div>
        <div class="font-medium" x-text="t.title"></div>
        <div class="text-sm opacity-70" x-text="t.message"></div>
      </div>
    </div>
  </template>
</div>


<button id="openAIButton" class="fixed bottom-4 right-4 z-40 bg-sky-600 hover:bg-sky-700 text-white p-3 rounded-full shadow-lg" title="Open AI Assistant">
  <i data-lucide="bot" class="w-6 h-6"></i>
</button>

<div id="aiChatWindow" class="fixed bottom-16 right-4 z-40 w-80 h-96 bg-white rounded-lg shadow-2xl flex flex-col hidden overflow-hidden" style="display:none;">
  <div class="bg-sky-700 text-white p-3 flex justify-between items-center">
    <h4 class="font-semibold">AI Assistant</h4>
    <button id="closeAIButton" class="p-1 rounded hover:bg-sky-600">
      <i data-lucide="x" class="w-4 h-4"></i>
    </button>
  </div>
  <div id="chatOutput" class="flex-1 p-3 overflow-y-auto flex flex-col gap-2">
    <div class="text-sm text-gray-500 text-center p-2 border-b"><br>I'm Still Under Development.</br></div>
  </div>
  <div class="p-3 border-t flex gap-2">
    <input id="chatInput" type="text" placeholder="Ask a question..." class="flex-1 p-2 border rounded focus:outline-none focus:ring-2 focus:ring-sky-500" />
    <button id="sendBtn" class="bg-sky-700 text-white px-3 py-2 rounded hover:bg-sky-800">
      <i data-lucide="send" class="w-4 h-4"></i>
    </button>
  </div>
</div>
<script src="main.js"></script>

</body>
</html>